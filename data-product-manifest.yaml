version: 0.0.31
jobId: "738"
jobName: MSGA_Report
jobType: Aggregated Data Product
alias: Ingesting_data_into_adp_msga_report
discoveryPort:
  name: MSGA_Report
inputPorts:
  - alias: Geography_Master_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:53e98ba0-c6f7-4a2f-9d78-0b8a4eefdf71
    projection: ""
    filter: ""
    warehousePath: "***s3StateBucket***"
    type: readDataIceberg
    catalogName: glue
    optional:
      persistDataFrame: false
      advanceOptions:
        endPoint: s3.undefined.amazonaws.com
        accessKey: abc
        secretKey: abc
      dataProductUrn: urn:dv:dataproduct:53e98ba0-c6f7-4a2f-9d78-0b8a4eefdf71
    tableName: select * from
      glue.***catalogReference***.`53e98ba0-c6f7-4a2f-9d78-0b8a4eefdf71`
  - alias: Dealer_Master_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:54ddeeb9-ff9a-4d57-8fbc-afafa0d45fe9
    projection: ""
    filter: ""
    warehousePath: "***s3StateBucket***"
    type: readDataIceberg
    catalogName: glue
    optional:
      persistDataFrame: false
      advanceOptions:
        endPoint: s3.undefined.amazonaws.com
        accessKey: abc
        secretKey: abc
      dataProductUrn: urn:dv:dataproduct:54ddeeb9-ff9a-4d57-8fbc-afafa0d45fe9
    tableName: select * from
      glue.***catalogReference***.`54ddeeb9-ff9a-4d57-8fbc-afafa0d45fe9`
  - alias: Parts_Accessories_Master_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:0be1464a-0830-4d11-990a-8a5b057c1b63
    projection: ""
    filter: ""
    warehousePath: "***s3StateBucket***"
    type: readDataIceberg
    catalogName: glue
    optional:
      persistDataFrame: false
      advanceOptions:
        endPoint: s3.undefined.amazonaws.com
        accessKey: abc
        secretKey: abc
      dataProductUrn: urn:dv:dataproduct:0be1464a-0830-4d11-990a-8a5b057c1b63
    tableName: select * from
      glue.***catalogReference***.`0be1464a-0830-4d11-990a-8a5b057c1b63`
  - alias: Accessories_Sales_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:b5b29d5a-edb2-47f1-8818-d83b9f80e675
    projection: ""
    filter: ""
    warehousePath: "***s3StateBucket***"
    type: readDataIceberg
    catalogName: glue
    optional:
      persistDataFrame: false
      advanceOptions:
        endPoint: s3.undefined.amazonaws.com
        accessKey: abc
        secretKey: abc
      dataProductUrn: urn:dv:dataproduct:b5b29d5a-edb2-47f1-8818-d83b9f80e675
    tableName: select * from
      glue.***catalogReference***.`b5b29d5a-edb2-47f1-8818-d83b9f80e675`
  - alias: Customer_Master_1
    isDynamic: true
    dataProductUrn: urn:dv:dataproduct:1b79b15f-2356-40d2-b50e-bda2b08e13e0
    projection: ""
    filter: ""
    warehousePath: "***s3StateBucket***"
    type: readDataIceberg
    catalogName: glue
    optional:
      persistDataFrame: false
      advanceOptions:
        endPoint: s3.undefined.amazonaws.com
        accessKey: abc
        secretKey: abc
      dataProductUrn: urn:dv:dataproduct:1b79b15f-2356-40d2-b50e-bda2b08e13e0
    tableName: select * from
      glue.***catalogReference***.`1b79b15f-2356-40d2-b50e-bda2b08e13e0`
productState:
  isDynamic: true
  alias: Ingesting_data_into_adp_msga_report
  retentionVersions: ""
  logicalSchema:
    properties: {}
  stateStoreType: loadDataIceberg
  isProfilingEnabled: false
  updateStrategy: Overwrite
  tableName: msil_transformed_layer.MSGA_Report
  warehousePath: s3://dlp-platform-engine-bucket/
  catalogName: glue
  optional:
    persistDataFrame: false
    enableDataReconciliation: false
    enforceSchema: false
    enforceSchemaMethod: Warning
    catalogType: glue
  refreshInterval: 0 10 * * *
transformation:
  - alias: Spark_SQL_1
    type: SQL
    description: tranformation logic for MSGA
    query: select    distinct SUM(MRP) AS MRP_1,    SUM(ITEM_VALUE) AS
      ITEM_VALUE,    part_description,   location_description,   region_code,   state_code,   status,   enq_status,   enquiry_orderreadiness_date,   link_part_enquiry,   parent_group,   dealer_map_code,   location_code,   short_enq_no,   part_number,   CUSTOMER_NAME,   CUSTOMER_STATE,   state,    source_of_enquiry,    customer_remarks,    mode_of_enquiry,    invoice_number,    for_code,    region,    dealer_name,    dealer_code,    invoice_date,    enquiry_number,    enquiry_date
      from    (     select        distinct PAM.MRP_1 AS
      MRP,        ACC.ITEM_VALUE AS ITEM_VALUE,        IG.state_name as
      state,        acc.PH_ENQ_ENQ_SOURCE AS
      source_of_enquiry,        ACC.PH_ENQ_CUST_REMARKS AS
      customer_remarks,        acc.PH_ENQ_ENQ_MOD AS
      mode_of_enquiry,        acc.PH_ENQ_INVOICE_NUM AS
      invoice_number,        DM.FOR_CODE AS for_code,        IG.region_name AS
      region,        DM.DEALER_NAME AS dealer_name,        DM.MUL_DEALER_Code AS
      dealer_code,        acc.PH_ENQ_INVOICE_DATE AS invoice_date,     'I' AS
      status,    'I' AS enq_status,       '' AS
      enquiry_orderreadiness_date,       concat_WS('|',PH_ENQ_PARENT_GROUP,PH_ENQ_DEALER_MAP_CD,PH_ENQ_LOC_CD,PH_ENQ_ENQ_NUM)
      as link_part_enquiry,       ACC.PH_ENQ_ENQ_NUM AS
      enquiry_number,        ACC.PH_ENQ_ENQ_DATE AS
      enquiry_date,    First(PH_ENQ_ENQ_NUM,3) as
      short_enq_no,    ACC.PH_ENQ_CUST_STATE AS
      CUSTOMER_STATE,    PH_ENQ_PARENT_GROUP as
      parent_group,    PH_ENQ_DEALER_MAP_CD as dealer_map_code,    PH_ENQ_LOC_CD
      as location_code,    PAM.PART_NUM as part_number,    PAM.PART_DESC AS
      PART_DESCRIPTION,    IG.REGION_CODE AS REGION_CODE,    IG.STATE_CODE AS
      STATE_CODE,    DM.location_description as
      LOCATION_DESCRIPTION,    ACC.PH_ENQ_CUST_NAME AS
      CUSTOMER_NAME     from        accessories_sales acc        left join
      parts_accessories_master pam on acc.PD_ENQ_part_num =
      pam.PART_NUM_VAR       left JOIN dealer_master DM on
      concat(         acc.PH_ENQ_PARENT_GROUP,          '|',          cast(           acc.PH_ENQ_DEALER_MAP_CD
      as string         ),          '|',          acc.PH_ENQ_LOC_CD       )=
      concat(         DM.PARENT_GROUP,          '|',          cast(DM.dealer_map_code
      as string),          '|',          DM.location_code       )        inner
      join (         select            distinct
      state_name,            region_name,            state_code,            region_code          from            geography_master       )
      ig on TRIM(acc.PH_ENQ_CUST_STATE)= TRIM(ig.STATE_CODE)        AND
      DM.region_code = IG.REGION_CODE   )  GROUP
      BY    part_description,   location_description,   region_code,   state_code,   status,   enq_status,   enquiry_orderreadiness_date,   link_part_enquiry,   parent_group,   dealer_map_code,   location_code,   short_enq_no,   part_number,   CUSTOMER_NAME,   CUSTOMER_STATE,   state,    source_of_enquiry,    remarks,    mode_of_enquiry,    invoice_number,    for_code,    region,    dealer_name,    dealer_code,    invoice_date,    enquiry_number,    enquiry_date
    sequenceNo: 6
    references:
      - alias: Dealer_Master_1
        sqlReference: dealer_master
      - alias: Geography_Master_1
        sqlReference: geography_master
      - alias: Accessories_Sales_1
        sqlReference: accessories_sales
      - alias: Parts_Accessories_Master_1
        sqlReference: parts_accessories_master
      - alias: Customer_Master_1
        sqlReference: customer_master
controlPort:
  dataQualityRules:
    RecordCountCheck:
      productState:
        expression: ">="
        number: 1
        referenceAlias: Ingesting_data_into_adp_msga_report
outputPort:
  subscriptionChannels:
    - channelType: Postgres
      queryType: SQL
